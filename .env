# =========================
# App / Environment
# =========================
APP_NAME=hexmedia
APP_ENV=development            # development | test | staging | production
LOG_LEVEL=INFO                 # TRACE/DEBUG/INFO/WARN/ERROR
TZ=UTC

# =========================
# Docker bind user/group
# =========================
DOCKER_UID=1000
DOCKER_GID=1000
DOCKER_SHARED_ROOT=/mnt/shared   # inside container path

# =========================
# Paths / Storage layout
# =========================
# Host-side roots (for local/dev). In the app, join with *_SUBDIR values.
DATA_ROOT=/media/sf_common_shared/hexmedia
INCOMING_SUBDIR=incoming
MEDIA_SUBDIR=media
PROCESSED_SUBDIR=processed       # (optional) where finalized assets go
TEMP_SUBDIR=.tmp                 # (optional) scratch during ingest

# Optional: absolute overrides (if you want to bypass the join logic)
# INCOMING_ROOT=/abs/path/override
# MEDIA_ROOT=/abs/path/override

# =========================
# Identity / Naming Rules
# =========================
BUCKET_NAME_LENGTH=7
ITEM_NAME_LENGTH=7
HEXMEDIA_BUCKET_MAX=2000

# =========================
# Allowed Extensions
# =========================
HEXMEDIA_VIDEO_EXTS=mp4,mov,flv
HEXMEDIA_IMAGE_EXTS=jpg,jpeg,png,gif,webp
HEXMEDIA_SIDECAR_EXTS=vtx

# =========================
# Concurrency & Backpressure
# =========================
MAX_SCAN_WORKERS=8              # ThreadManager max workers for scanning
HASH_WORKERS=4                  # separate pool for hashing if you split
FFPROBE_WORKERS=4               # separate pool for ffprobe if you split
THREAD_QUEUE_MAXSIZE=64         # bounded queue to prevent overload
CANCEL_ON_EXIT=true             # ThreadManager cooperative cancel on shutdown

# =========================
# FFprobe / Media Tools
# =========================
FFPROBE_BIN=ffprobe            # or /usr/bin/ffprobe inside container
FFPROBE_TIMEOUT_SEC=30
FFPROBE_LOG_LEVEL=error        # quiet|panic|fatal|error|warning|info|verbose|debug|trace

# =========================
# API / HTTP
# =========================
API_HOST=0.0.0.0
API_PORT=8000
API_PREFIX=/api
CORS_ALLOW_ORIGINS=http://localhost:5173
CORS_ALLOW_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOW_HEADERS=*
CORS_ALLOW_CREDENTIALS=false

# =========================
# Database (components)
# =========================
DB_DRIVER=postgresql+psycopg
DB_HOST=localhost
DB_PORT=5432
DB_NAME=hexmedia
DB_USER=hexuser
DB_PASSWORD=hexpass
DB_SCHEMA=hexmedia

# Optional unified URL (preferred by Alembic CLI). If you set this,
# your app can use it directly; otherwise compose it from parts above.
# Note: dotenv doesn't expand variables by default, so keep it explicit:
DATABASE_URL=postgresql+psycopg://hexuser:hexpass@localhost:5432/hexmedia

# =========================
# Alembic / Migrations
# =========================
ALEMBIC_SCRIPT_LOCATION=hexmedia/database/alembic
ALEMBIC_VERSION_TABLE_SCHEMA=public   # or hexmedia; public is simplest

# =========================
# Testcontainers / CI toggles
# =========================
USE_TESTCONTAINERS=true         # enable ephemeral DB for tests
TEST_DB_IMAGE=postgres:15-alpine
TEST_DB_WAIT_TIMEOUT_SEC=30

# =========================
# Feature Flags
# =========================
FEATURE_INGEST_ENABLED=true
FEATURE_DUP_DETECT_BY_HASH=true
FEATURE_WRITE_PHASH=false       # enable when perceptual hash is implemented
FEATURE_ASSET_AUTOGEN_THUMBS=false

# =========================
# Security (fill for prod)
# =========================
JWT_SECRET=dev-only-secret      # rotate in production
JWT_ALGO=HS256
# OAUTH_* or SSO_* vars here if/when added

# =========================
# Observability
# =========================
ENABLE_STRUCTURED_LOGS=true     # JSON logs
SENTRY_DSN=                     # optional
METRICS_ENABLED=false
METRICS_PORT=9102
